# 输出段

## 输出段地址

`地址(address)` 是对于输出文件的 `虚拟内存地址(Virtual memory address)`的一个表达式。
这个地址是可选的，但是如果一旦提供，那么输出地址将会完全按照指定设置。

如果输出地址没有指定，那么会根据下面的启发式方法为该段选择一个。
地址会被调整为以适应输出段的内存对其要求。该对齐要求是包含在输出段中任何输入段的最严格对齐。

输出段地址启发式遵循如下：

- 如果输出内存 `区域(region)` 被用于段，那就加载到这个区域中，他的地址将会是那个区域的下一个空闲地址。

- 如果 *MEMORY* 指令已经被用于创建一个内存区域列表，那么选择第一个与段兼容的区域来容纳他。
段的输出地址将是那个区域的下一个空闲地址。

- 如果没有内存区域指定，或者没有一个匹配到段，那么输出地址会基于当前的位置计数器的值。

例如：

```ld
    .text . : { *(.text) }
```

和

```ld
    .text : { *(.text) }
```

有一些略微的不同。第一个例子将会把 `.text` 输出段设置为当前位置计数器的值。
而第二个例子将 `.text` 输出段设置为任何 `.text` 输入段的最严格对齐的对齐方式一致的当前位置计数器的值。

地址可以是一个任意的表达式。比如你想在 `0x10` 字节边界上对齐，以便最低四位是0，你可以这么做

```ld
    .text ALIGN(0x10) : { *(.text) }
```

这么做的原理是 *ALIGN* 返回的当前位置计数器向上对齐到指定的值。

指定段的地址会改变位置计数器的值，前提是该段是非空的（忽略空的段）。

## References

<https://sourceware.org/binutils/docs/ld/Output-Section-Address.html>
